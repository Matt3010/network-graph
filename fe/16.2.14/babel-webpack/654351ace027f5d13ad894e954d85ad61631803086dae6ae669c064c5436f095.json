{"ast":null,"code":"import { debounceTime } from 'rxjs/operators';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../../services/note.service\";\nimport * as i2 from \"@angular/router\";\nfunction EditComponent_img_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 10);\n  }\n}\nfunction EditComponent_img_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 11);\n  }\n}\nfunction EditComponent_app_goback_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-goback\");\n  }\n}\nfunction EditComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 13);\n    i0.ɵɵelement(2, \"input\", 14);\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction EditComponent_app_notify_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-notify\", 15);\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"toNotify\", \"Saved\");\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"height\": a0,\n    width: \"100%\",\n    position: \"relative\",\n    \"font-size\": \"16px\",\n    \"background-color\": \"#f2f2f2\"\n  };\n};\nexport let EditComponent = /*#__PURE__*/(() => {\n  class EditComponent {\n    constructor(noteService, activatedRoute) {\n      this.noteService = noteService;\n      this.activatedRoute = activatedRoute;\n      this.isWriting = false;\n      this.hasSaved = false;\n      this.id = null;\n      this.window = window;\n      this.statistics = {\n        Chars: 0,\n        Words: 0,\n        Paragraphs: 0\n      };\n      this.isLock = false;\n      this.editForm = new FormGroup({\n        title: new FormControl(''),\n        body: new FormControl(''),\n        created_by: new FormControl(''),\n        created_at: new FormControl(''),\n        updated_at: new FormControl('')\n      });\n      this.initializeLock();\n      this.editForm.reset();\n      this.getNote();\n      this.editForm.valueChanges.pipe(debounceTime(500)).subscribe(() => {\n        if (this.editForm.touched) {\n          this.hasSaved = false;\n          this.save();\n        }\n      });\n      this.editForm.valueChanges.subscribe(() => {\n        this.updateStats();\n        this.hasSaved = false;\n      });\n    }\n    ngOnDestroy() {\n      this.editForm.reset();\n    }\n    updateStats() {\n      this.getBodyChars();\n      this.getBodyWords();\n      this.getBodyParagraphs();\n    }\n    getNote() {\n      this.activatedRoute.params.subscribe(params => {\n        this.id = params['id'];\n        this.noteService.find(this.id).subscribe(res => {\n          this.initForm(res);\n          this.note = res;\n        });\n      });\n    }\n    initializeLock() {\n      this.isLock = JSON.parse(localStorage.getItem('network-locked'));\n    }\n    toggleLock() {\n      this.isLock = !this.isLock;\n      localStorage.setItem('network-locked', JSON.stringify(this.isLock));\n    }\n    initForm(noteData) {\n      this.editForm.setValue({\n        title: noteData.title,\n        body: noteData.body,\n        created_by: noteData.created_by,\n        created_at: noteData.created_at,\n        updated_at: noteData.updated_at\n      });\n    }\n    save() {\n      this.noteService.saveNote({\n        id: this.id,\n        title: this.editForm.value.title,\n        body: this.addClassToImages(this.editForm.value.body),\n        created_by: this.editForm.value.created_by,\n        created_at: this.editForm.value.created_at,\n        updated_at: this.editForm.value.updated_at\n      }).subscribe(res => {\n        if (res === 'saved') {\n          this.hasSaved = true;\n        }\n      });\n    }\n    addClassToImages(body) {\n      return body === null ? '' : body.replace(/<img/g, '<img class=\"content-img\"');\n    }\n    getBodyChars() {\n      const body = this.editForm.controls.body.value || '';\n      const bodyText = this.stripHtmlTags(body).replace(/\\s/g, '');\n      this.statistics.Chars = bodyText.length;\n    }\n    getBodyWords() {\n      const body = this.editForm.controls.body.value || '';\n      const bodyText = this.stripHtmlTags(body);\n      const words = bodyText.match(/\\b\\w+\\b/g);\n      this.statistics.Words = words ? words.length : 0;\n    }\n    getBodyParagraphs() {\n      const body = this.editForm.controls.body.value || '';\n      const paragraphs = body.split(/\\s*<p>\\s*<br>\\s*<\\/p>\\s*/g).filter(Boolean);\n      this.statistics.Paragraphs = paragraphs.length;\n    }\n    stripHtmlTags(html) {\n      return html.replace(/(<([^>]+)>)/gi, '');\n    }\n    onKeyDown(event) {\n      if (event.keyCode === 83 && event.ctrlKey) {\n        event.preventDefault();\n        this.save();\n      }\n    }\n    static #_ = this.ɵfac = function EditComponent_Factory(t) {\n      return new (t || EditComponent)(i0.ɵɵdirectiveInject(i1.NoteService), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: EditComponent,\n      selectors: [[\"app-edit\"]],\n      hostBindings: function EditComponent_HostBindings(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵlistener(\"keydown.control.s\", function EditComponent_keydown_control_s_HostBindingHandler($event) {\n            return ctx.onKeyDown($event);\n          }, false, i0.ɵɵresolveDocument);\n        }\n      },\n      decls: 10,\n      vars: 14,\n      consts: [[1, \"lock-unlock\", 3, \"click\"], [\"width\", \"20px\", \"src\", \"assets/network_assets/unlock-alt-svgrepo-com.svg\", \"alt\", \"lock\", 4, \"ngIf\"], [\"width\", \"20px\", \"src\", \"assets/network_assets/lock-alt-svgrepo-com.svg\", \"alt\", \"lock\", 4, \"ngIf\"], [\"href\", \"https://cdn.jsdelivr.net/npm/quill@1/dist/quill.snow.css\", \"rel\", \"stylesheet\"], [4, \"ngIf\"], [1, \"form\", \"position-relative\", \"h-100\", \"w-100\", 3, \"formGroup\"], [\"class\", \"row title\", 4, \"ngIf\"], [\"formControlName\", \"body\", 1, \"position-relative\", \"p-editor\", 3, \"placeholder\"], [3, \"statistics\"], [3, \"toNotify\", 4, \"ngIf\"], [\"width\", \"20px\", \"src\", \"assets/network_assets/unlock-alt-svgrepo-com.svg\", \"alt\", \"lock\"], [\"width\", \"20px\", \"src\", \"assets/network_assets/lock-alt-svgrepo-com.svg\", \"alt\", \"lock\"], [1, \"row\", \"title\"], [1, \"col-auto\", \"center-mobile\", \"d-flex\", \"flex-column\"], [\"type\", \"text\", \"formControlName\", \"title\", 1, \"title-input\", \"text-truncate\", \"d-inline-block\", 2, \"max-width\", \"100%\"], [3, \"toNotify\"]],\n      template: function EditComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0);\n          i0.ɵɵlistener(\"click\", function EditComponent_Template_div_click_0_listener() {\n            return ctx.toggleLock();\n          });\n          i0.ɵɵtemplate(1, EditComponent_img_1_Template, 1, 0, \"img\", 1);\n          i0.ɵɵtemplate(2, EditComponent_img_2_Template, 1, 0, \"img\", 2);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(3, \"link\", 3);\n          i0.ɵɵtemplate(4, EditComponent_app_goback_4_Template, 1, 0, \"app-goback\", 4);\n          i0.ɵɵelementStart(5, \"form\", 5);\n          i0.ɵɵtemplate(6, EditComponent_div_6_Template, 3, 0, \"div\", 6);\n          i0.ɵɵelement(7, \"p-editor\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(8, \"app-statistics\", 8);\n          i0.ɵɵtemplate(9, EditComponent_app_notify_9_Template, 1, 1, \"app-notify\", 9);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.isLock);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.isLock);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.isLock);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"formGroup\", ctx.editForm);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.isLock);\n          i0.ɵɵadvance(1);\n          i0.ɵɵstyleMap(i0.ɵɵpureFunction1(12, _c0, ctx.window.innerHeight - 105 + \"px\"));\n          i0.ɵɵstyleProp(\"width\", \"100%\");\n          i0.ɵɵproperty(\"placeholder\", \"New note...\");\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"statistics\", ctx.statistics);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.hasSaved);\n        }\n      },\n      styles: [\"@media only screen and (max-width: 600px){  .ql-editor{padding:40px 5vw!important}  .ql-editor.ql-blank:before{padding:0px 2vw!important;font-style:normal!important}}@media only screen and (min-width: 601px) and (max-width: 1100px){  .ql-editor{padding:40px 10vw!important}  .ql-editor.ql-blank:before{padding:0px 8vw!important;font-style:normal!important}}@media only screen and (min-width: 1101px){  .ql-editor{padding:40px 25vw!important}  .ql-editor.ql-blank:before{padding:0px 24.4vw!important;font-style:normal!important}}  .ql-toolbar.ql-snow{border-top:0!important}.title[_ngcontent-%COMP%]{background-color:transparent;padding:10px}.title-input[_ngcontent-%COMP%]{background-color:#fff0;padding:10px;border:0;font-size:36px;font-weight:600;border-radius:8px;outline-color:transparent}@media only screen and (max-width: 600px){.title-input[_ngcontent-%COMP%]{text-align:center}.center-mobile[_ngcontent-%COMP%]{display:flex;justify-content:center}}.lock-unlock[_ngcontent-%COMP%]{position:fixed;top:20px;padding:5px 10px 10px;z-index:20;left:50%;transform:translate(-50%,-50%);cursor:pointer;background-color:#ffc8c8;border-bottom-right-radius:8px;border-bottom-left-radius:8px;opacity:.5}.lock-unlock[_ngcontent-%COMP%]:hover{padding:10px;transition:all .2s;opacity:1}.lock-unlock[_ngcontent-%COMP%]:not(:hover){padding:5px 10px 10px;transition:all .2s;opacity:.5}@keyframes _ngcontent-%COMP%_shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}\"]\n    });\n  }\n  return EditComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}